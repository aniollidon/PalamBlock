<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <title>Missatge</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html,body { height:100%; margin:0; font-family: system-ui, Arial, sans-serif; background:#111; color:#fff; }
    .wrapper { position:relative; height:100%; width:100%; display:flex; align-items:center; justify-content:center; padding:4vh 6vw; box-sizing:border-box; }
    #msg { font-weight:600; text-align:center; line-height:1.15; word-wrap:break-word; max-width:100%; max-height:100%; }
    .footer { position:fixed; bottom:8px; left:50%; transform:translateX(-50%); font-size:12px; color:#888; font-family:monospace; }
  </style>
</head>
<body>
  <div class="wrapper">
    <div id="msg"></div>
  </div>
  <div class="footer" id="footer"></div>
  <script>
    (function(){
      const params = new URLSearchParams(window.location.search);
      const text = params.get('text') || '';
      const temps = parseInt(params.get('temps') || '0',10);
  const esborraClick = false; // Eliminat tancament per clic
      const msgEl = document.getElementById('msg');
      const footer = document.getElementById('footer');
      msgEl.textContent = text;
      footer.textContent = [
        temps>0 ? `Es tancarà en ${temps}s` : 'Sense límit de temps',
  ''
      ].filter(Boolean).join(' | ');

      function adjustFont(){
        let min = 8; // px
        let max = 160; // px
        const wrapper = document.querySelector('.wrapper');
        const availW = wrapper.clientWidth - 10;
        const availH = wrapper.clientHeight - 10;
        while(min < max){
          const mid = Math.ceil((min+max)/2);
          msgEl.style.fontSize = mid + 'px';
          // Force reflow
          const over = msgEl.scrollWidth > availW || msgEl.scrollHeight > availH;
          if(over) { max = mid - 1; } else { min = mid; }
        }
        msgEl.style.fontSize = min + 'px';
      }
      window.addEventListener('resize', adjustFont);
      adjustFont();

      function closeMessage(reason='timeout', extra={}){
        const payload = { type:'palam-message-close', reason };
        // Adjuntar dades extra (p.ex dades del click)
        for (const k in extra) { payload[k] = extra[k]; }
        try { window.parent.postMessage(payload,'*'); } catch(e){}
        // Intentar netejar el contingut
        try { document.body.innerHTML=''; } catch(e){}
      }

      if (temps > 0) {
        setTimeout(()=>closeMessage('timeout'), temps*1000);
      }
  // Eliminat tancament per clic; només per temps
    })();
  </script>
</body>
</html>
